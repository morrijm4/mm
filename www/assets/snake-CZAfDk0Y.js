import"./theme-BBGeiQaj.js";const f=13,g=13,E=300;function v(n){return Math.max(E-Math.log(n.score+1)*60,100)}function t(n,e){if(!n)throw new Error(e)}function l(n,e){t(n.type==="snake",e)}function m(){const n=window.localStorage.getItem("high-score");return n==null?0:parseInt(n)}function w(n){window.localStorage.setItem("high-score",n.toString());const e=document.getElementById("high-score");t(e,"Cannot find high score dom node"),e.innerHTML=n.toString()}function L(){return{col:Math.floor(Math.random()*f),row:Math.floor(Math.random()*g)}}function a(n,e){var o;return(o=n[e.col])==null?void 0:o[e.row]}function S(){const n=document.getElementById("up"),e=document.getElementById("left"),o=document.getElementById("right"),r=document.getElementById("down");t(n),t(e),t(o),t(r),n.addEventListener("click",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),e.addEventListener("click",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowLeft"}))}),o.addEventListener("click",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowRight"}))}),r.addEventListener("click",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))})}function C(n){return Array.from({length:f},(e,o)=>{const r=document.createElement("div");return n.appendChild(r),Array.from({length:g},(i,c)=>{const d=document.createElement("div");return r.appendChild(d),d.classList.add("custom-border"),d.classList.add("lg:p-4"),d.classList.add("p-3"),d})})}function I(n){return n.map(e=>e.map(o=>({type:"empty",element:o})))}function k(n){const e=L(),o=a(n,e);return t(o,"Unable to find point in createFoodPoint"),o.type!=="empty"?k(n):e}function B(n){return async e=>{switch(e.preventDefault(),e.key){case"ArrowUp":case"w":if(n.direction==="down")return;n.pendingDirection="up";break;case"ArrowDown":case"s":if(n.direction==="up")return;n.pendingDirection="down";break;case"ArrowLeft":case"a":if(n.direction==="right")return;n.pendingDirection="left";break;case"ArrowRight":case"d":if(n.direction==="left")return;n.pendingDirection="right";break}const o=a(n.grid,n.head);t(o,"Cannot find head node"),l(o),o.direction=n.direction}}function A(n){w(m());const e=I(n),o={col:Math.floor(f/2)-2,row:Math.floor(g/2)},r={col:o.col-2,row:o.row},i="right",c=a(e,o),d=a(e,{col:o.col-1,row:o.row}),s=a(e,r);t(c,"Cannot find snake node"),t(d,"Cannot find snake node"),t(s,"Cannot find snake node"),c.type="snake",d.type="snake",s.type="snake",l(c),l(d),l(s),c.direction=i,d.direction=i,s.direction=i;const y={col:o.col+6,row:o.row},h=a(e,y);t(h,"Cannot find food node"),h.type="food";const u={direction:i,pendingDirection:i,grid:e,score:0,pause:!1,controller:new AbortController,food:y,head:o,tail:r,gameOver:!1,title:""};return document.addEventListener("keydown",B(u),{signal:u.controller.signal}),u}function b(n){const e=document.getElementById("play-button");t(e,"play button not found"),n.gameOver?(n.controller.abort(),e.classList.remove("invisible"),m()<n.score&&w(n.score)):e.classList.add("invisible");const o=document.getElementById("title");t(o,"Could not find title"),o.innerText=n.title;for(const i of n.grid)for(const c of i)switch(c.element.classList.remove("bg-red-500","bg-yellow-500"),c.type){case"empty":break;case"food":c.element.classList.add("bg-red-500");break;case"snake":c.element.classList.add("bg-yellow-500");break}const r=document.getElementById("score");t(r,"Could not find score"),r.innerHTML=n.score.toString()}function p(n,e){switch(n){case"down":e.row+=1;break;case"left":e.col-=1;break;case"right":e.col+=1;break;case"up":e.row-=1;break}}function D(n){n.direction=n.pendingDirection;const e=a(n.grid,n.head);if(t(e,"Cannot find old head node"),l(e),e.direction=n.direction,n.pause)return;p(n.direction,n.head);const o=a(n.grid,n.head);if(o==null||o.type==="snake"){n.gameOver=!0,n.title="Game over!";return}if(o.type==="food"){n.score+=1,n.food=k(n.grid);const r=a(n.grid,n.food);t(r,"Cannot find food node"),r.type="food"}else{const r=a(n.grid,n.tail);t(r,"Could not find tail");const i=r;l(i),r.type="empty",p(i.direction,n.tail)}o.type="snake",l(o),o.direction=n.direction}async function M(n){return new Promise(e=>setTimeout(e,n))}async function N(n,e){await M(e),D(n),b(n)}async function H(n){for(b(n);!n.controller.signal.aborted;)await N(n,v(n))}function P(){w(m()),S();const n=document.getElementById("root");t(n,"Cannot find root node");const e=C(n),o=document.getElementById("play-button");t(o,"Cannot find play button"),o.addEventListener("click",()=>H(A(e)))}P();
